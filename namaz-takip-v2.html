<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Namaz Takip</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
    h2, h3 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    th { background: #eee; }
    .checkbox-cell input { transform: scale(1.2); }
    .login { max-width: 300px; margin: 0 auto; padding: 20px; background: #fff; border: 1px solid #ccc; }
    .login input { width: 100%; padding: 8px; margin-bottom: 10px; }
    .hidden { display: none; }
    @media (max-width: 600px) {
      th, td { font-size: 12px; }
      .checkbox-cell input { transform: scale(1.5); }
    }
  </style>
</head>
<body>
  <div id="loginDiv" class="login">
    <h2>Giriş Yap</h2>
    <input type="text" id="username" placeholder="Kullanıcı Adı" />
    <input type="password" id="password" placeholder="Şifre" />
    <button onclick="login()">Giriş</button>
    <p id="loginError" style="color:red;"></p>
  </div>

  <div id="mainApp" class="hidden">
    <h2 id="panelTitle">Namaz Takip</h2>
    <div id="adminPanel" class="hidden">
      <label for="userSelect">Kullanıcı Seç:</label>
      <select id="userSelect" onchange="loadTable()"></select>
    </div>
    <table>
      <thead>
        <tr>
          <th rowspan="2">Tarih</th>
          <th colspan="2">Sabah</th>
          <th colspan="2">Öğle</th>
          <th colspan="2">İkindi</th>
          <th colspan="2">Akşam</th>
          <th colspan="2">Yatsı</th>
          <th rowspan="2">Oruç</th>
          <th rowspan="2">Sadaka</th>
        </tr>
        <tr>
          <th>Sünnet</th><th>Farz</th>
          <th>Sünnet</th><th>Farz</th>
          <th>Sünnet</th><th>Farz</th>
          <th>Sünnet</th><th>Farz</th>
          <th>Sünnet</th><th>Farz</th>
        </tr>
      </thead>
      <tbody id="namazTableBody"></tbody>
    </table>
    <div class="summary">
      <h3>Toplam Başarı: <span id="successRate">0%</span></h3>
    </div>
  </div>

  <script>
    const users = { "ali": "1234", "ayse": "5678", "admin": "0000" };
    let currentUser = null;
    let viewUser = null;

    const vakitSayisi = 10; // 5 vakit x 2 (sünnet+farz)
    const extraCount = 2; // oruç, sadaka

    function login() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      if (users[username] && users[username] === password) {
        currentUser = username;
        viewUser = username;
        document.getElementById('loginDiv').classList.add('hidden');
        document.getElementById('mainApp').classList.remove('hidden');
        if (username === 'admin') setupAdminPanel();
        loadTable();
      } else {
        document.getElementById('loginError').textContent = "Hatalı kullanıcı adı veya şifre.";
      }
    }

    function setupAdminPanel() {
      const userSelect = document.getElementById('userSelect');
      document.getElementById('adminPanel').classList.remove('hidden');
      document.getElementById('panelTitle').textContent = 'Yönetici Paneli';
      userSelect.innerHTML = '';
      for (let user in users) {
        if (user !== 'admin') {
          const option = document.createElement('option');
          option.value = user;
          option.textContent = user;
          userSelect.appendChild(option);
        }
      }
      viewUser = userSelect.value;
    }

    function getStorageKey(user, dateStr) {
      return `v2data_${user}_${dateStr}`;
    }

    function loadTable() {
      if (currentUser === 'admin') {
        viewUser = document.getElementById('userSelect').value;
      }
      const tbody = document.getElementById('namazTableBody');
      tbody.innerHTML = '';
      const today = new Date();
      let total = 0, completed = 0;

      for (let i = 0; i < 7; i++) {
        const date = new Date(today);
        date.setDate(today.getDate() - i);
        const dateStr = date.toISOString().slice(0, 10);
        const row = document.createElement('tr');
        row.innerHTML = `<td>${dateStr}</td>`;

        const stored = JSON.parse(localStorage.getItem(getStorageKey(viewUser, dateStr)) || '[]');
        for (let j = 0; j < vakitSayisi + extraCount; j++) {
          const cell = document.createElement('td');
          cell.classList.add('checkbox-cell');
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.checked = stored[j] || false;
          checkbox.addEventListener('change', () => {
            stored[j] = checkbox.checked;
            localStorage.setItem(getStorageKey(viewUser, dateStr), JSON.stringify(stored));
            updateSuccess();
          });
          cell.appendChild(checkbox);
          row.appendChild(cell);
          total++;
          if (checkbox.checked) completed++;
        }
        tbody.appendChild(row);
      }
      updateSuccess(completed, total);
    }

    function updateSuccess(initCompleted = null, initTotal = null) {
      const checkboxes = document.querySelectorAll('tbody input[type="checkbox"]');
      const total = initTotal ?? checkboxes.length;
      const completed = initCompleted ?? Array.from(checkboxes).filter(cb => cb.checked).length;
      const percent = Math.round((completed / total) * 100);
      document.getElementById('successRate').textContent = percent + "%";
    }
  </script>
</body>
</html>
